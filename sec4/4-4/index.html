<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vue SPA Sample</title>
  <style>
    /* 割愛 */
  </style>
</head>
<body>
  <div id="app">
    <nav>
      <!-- router-link によるナビゲーション定義 -->
      <router-link to="/top">トップページ</router-link>
      <router-link to="users">ユーザー一覧ページ</router-link>
    </nav>
    <router-view></router-view>
  </div>

  <!-- Vuew.js 本体とVue Router の読み込み -->
  <script src="https://unpkg.com/vue@2.5.17"></script>
  <script src="https://unpkg.com/vue-router@2.7.0/dist/vue-router.min.js"></script>

  <!-- コンポーネント定義 各コンポーネントごとに script タグを切っていく -->

  <!-- ユーザー一覧コンポーネント -->
  <script type="text/x-template" id="user-list">
    <div>
      <div class="loading" v-if="loading">読み込み中...</div>
      <div v-if="error" class="error">
        {{ error }}
      </div>
      <!-- usersがロードされたら各ユーザーの名前を表示する -->
      <div v-for="user in users" :key="user.id">
        <h2>{{ user.name }}</h2>
      </div>
    </div>
  </script>

  <!-- Vue Script -->
  <script>
    // jsonを返す関数
    var getUsers = function(callback) {
      setTimeout(function() {
        callback(null, [
          {
            id: 1,
            name: "Kento Takano",
          },
          {
            id: 2,
            name: "Yui Aragaki",
          }
        ])
      }, 1000)
    }

    // ユーザー一覧コンポーネント定義
    var UserList = {
      template: "#user-list",
      data: function() {
        return {
          loading: false,                   // 初期値
          users: function() { return [] },  // 初期値
          error: null                       // 初期値
        }
      },
      // データ初期化後にデータ取得
      created: function() {
        this.fetchData()
      },

      // $routeの変更を監視して変更を検知した場合データを再度取得する
      watch: {
        "$route": "fetchData"
      },
      // TODO: methods を実装 fetchData
    }
    var router = new VueRouter({
      routes: [
        {
          path: "/top",
          component: {
            template: "<div>トップページです。</div>"
          }
        },
        {
          path: "/users",
          component: UserList
        }
      ]
    })

    var app = new Vue({
      router: router
    }).$mount("#app")
  </script>
</body>
</html>